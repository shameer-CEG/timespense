{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block title %}Change Password{% endblock title %}
{% block body %}

<style>
    /* Responsive field icon for password visibility toggle */
    .password-wrapper {
        position: relative;
    }

    /* Ensure icon is on top of input and always clickable */
    .field-icon {
        position: absolute;
        right: 10px;
        /* Adjust for icon alignment */
        font-size: 1.2rem;
        /* Adjust size for responsiveness */
        color: #888;
        cursor: pointer;
        z-index: 10;
        /* Ensure icon stays on top of input */
        pointer-events: auto;
        /* Ensure icon is always clickable */
    }

    /* Ensures responsiveness on smaller screens */
    @media (max-width: 576px) {
        .field-icon {
            font-size: 1rem;
            right: 8px;
            /* Adjust icon alignment for smaller screens */
        }
    }
</style>
<div class="container p-4 mb-5">
    <nav style="--bs-breadcrumb-divider: '>';" class="mt-3" aria-label="breadcrumb">
        <ol class="breadcrumb ps-4 py-3 ">
            <li class="breadcrumb-item"><a class="active-breadcrumb" href="{% url 'overall_dashboard' %}">Dashboard</a>
            </li>

            {% if shop.shop_id %}
            <li class="breadcrumb-item" aria-current="page"><a
                    href="{% url 'shop_profile' shop_id=shop.encoded_shop_id %}"
                    class="active-breadcrumb">{{shop.shop_name}} Dashboard</a></li>
            {% endif %}

            <li class="breadcrumb-item" aria-current="page"><a href="#" class="current-breadcrumb disabled">Change
                    Password
                </a></li>

        </ol>
    </nav>
    <div class="container-fluid p-md-5 p-4 border rounded border-2 border-mine shadow-lg bg-light">
        <div class="container">

            {% if messages %}
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
            {% endif %}

            <h2>Change Password</h2>


            <!-- Password change form -->
            <form method="post" autocomplete="off">
                {% csrf_token %}

                <!-- Old password field -->
                <div class="mb-3">
                    <label for="id_old_password" class="form-label">Current Password</label>
                    <input type="password" name="old_password" id="id_old_password" class="form-control"
                        placeholder="Enter your current password" required>
                </div>

                <!-- New password field -->
                <div class="mb-3">
                    <label for="id_new_password1" class="form-label">New Password</label>
                    <input type="password" name="new_password1" id="id_new_password1" class="form-control"
                        placeholder="Enter a new password" autocomplete="new-password" required>
                </div>

                <!-- Confirm new password field -->
                <div class="mb-3">
                    <label for="id_new_password2" class="form-label">Confirm New Password</label>
                    <input type="password" name="new_password2" id="id_new_password2" class="form-control"
                        placeholder="Re-enter your new password" autocomplete="new-password" required>
                </div>

                <!-- Submit button -->
                <button type="submit" class="btn btn-primary">Change Password</button>

                <!-- Forgot password link -->
                <div class="mt-3">
                    <a class="btn" href="{% url 'password' %}">Forgot Password?</a>
                </div>
            </form>
        </div>
    </div>

</div>
</div>


<!-- JavaScript for toggling password visibility -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Select all password inputs generated by crispy form
        document.querySelectorAll('input[type="password"]').forEach(passwordField => {
            // Create the eye icon element
            const toggleIcon = document.createElement('span');
            toggleIcon.classList.add('fa', 'fa-fw', 'fa-eye', 'field-icon', 'toggle-password');
            toggleIcon.style.cursor = 'pointer';

            // Wrap the input and icon in a flex container for alignment
            const wrapper = document.createElement('div');
            wrapper.classList.add('password-wrapper');
            wrapper.style.display = 'flex';
            wrapper.style.alignItems = 'center';
            wrapper.style.position = 'relative';

            // Move the input into the wrapper
            passwordField.parentNode.insertBefore(wrapper, passwordField);
            wrapper.appendChild(passwordField);
            wrapper.appendChild(toggleIcon);

            // Add event listener for the toggle functionality
            toggleIcon.addEventListener('click', () => {
                const isPassword = passwordField.getAttribute('type') === 'password';
                passwordField.setAttribute('type', isPassword ? 'text' : 'password');
                toggleIcon.classList.toggle('fa-eye-slash', isPassword);
                toggleIcon.classList.toggle('fa-eye', !isPassword);
            });
        });
    });
</script>

{% endblock body %}